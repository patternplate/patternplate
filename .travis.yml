language: node_js
node_js:
  - 8
script:
  - echo "no main script"
jobs:
  include:
    - stage: test
      if: branch != master
      script:
        - >-
          yarn build &&
          yarn run pack &&
          yarn examples:build &&
          rm -r node_modules/@patternplate/test-example && ln -s "$(realpath tools/test-example/)" node_modules/@patternplate &&
          yarn examples:test &&
          yarn components:build --stream &&
          yarn components:test
    - stage: test
      if: branch = master
      script:
        - yarn test --stream
        - yarn lerna run deps --stream
      script:
        - >-
          yarn build &&
          yarn run pack &&
          yarn components:build --stream &&
          rm -r node_modules/@patternplate/test-example && ln -s "$(realpath tools/test-example/)" node_modules/@patternplate &&
          yarn components:test &&
          ./.travis/decrypt.sh &&
          ./.travis/deploy.sh
